<script type="text/javascript">$(function(){    /**     * Flickr API Key and some parameter     */    var flickr_api_key              = 'c6367d3c8dc3e854f37c519ffbd38020';    var quick_select_wrapper        = '.entryFormColumnSettingTable';    var quick_select_target_normal  = 'input[name^="eximage_normal"]';    var quick_select_target_large   = 'input[name^="eximage_large"]';     /**     * Quick Select from Thumbnails     */    $('.js-quick_select').live('click', function()    {        // get user_id        var user_id = $(this).attr('rel');         // read target elements        var $parent = $(this).parents().filter(quick_select_wrapper).get(0);         $.ajax({            type    : 'GET',            url     : 'http://api.flickr.com/services/rest/',            data    : {                format  : 'json',                user_id : user_id,                api_key : flickr_api_key,                method  : 'flickr.photos.search'            },            dataType: 'jsonp',            jsonp   : 'jsoncallback',            success : function(json)            {                if ( json.stat == 'ok' ) {                    var photos = json.photos.photo;                    var $thumbBox = $('<div id="js-flickr-thumbnail_box" />');                     // create float box                    $('body').append($thumbBox);                     // append thumbnails                    var len = photos.length;                    for ( var i=0; i < len; i++ ) {                        var photo = photos[i];                        var thumb = 'http://farm'+photo.farm+'.static.flickr.com/'+photo.server+'/'+photo.id+'_'+photo.secret+'_s.jpg';                        var $cont = $('<div class="thumbnail_container" id="'+photo.id+'">'+                                        '<img src="'+thumb+'" alt="'+photo.title+'" />'+                                    '</div>');                        $thumbBox.append($cont);                        $.data($cont.get(0), 'parent-target', $parent);                    }                     // centering                    $thumbBox.position({                        'of'    : window,                        'my'    : 'center center'                    }).hide().fadeIn('200');                     // suicide                    $(document).unbind('click.thumbBox');                    $(document).bind('click.thumbBox', function ( )                    {                        $('#js-flickr-thumbnail_box').remove();                        $(document).unbind('click.thumbBox');                    });                 } else {                    // error                }            }        });        return false;    });     $('.thumbnail_container').live('click', function()    {        var photo_id = $(this).attr('id');        var src      = $('img', this).attr('src').replace(/_s\./, '_m.');        var thumbnail= '<img src="' + src + '" />';         var $parent = $($.data($(this).get(0), 'parent-target'));         var $normal = $(quick_select_target_normal, $parent);        var $large  = $(quick_select_target_large,  $parent);         $.ajax({            type    : 'GET',            url     : 'http://api.flickr.com/services/rest/',            data    : {                format  : 'json',                photo_id : photo_id,                api_key : flickr_api_key,                method  : 'flickr.photos.getSizes'            },            dataType: 'jsonp',            jsonp   : 'jsoncallback',            success : function(json)            {                if ( json.stat == 'ok' ) {                    var $sizeBox = $('<div id="js-flickr-size_box">'+                                        '<form>'+                                            '<table id="js-flickr-size_box-table">'+                                                '<tr><th>サイズ名</th><th>標準</th><th>拡大</th></tr>'+                                            '</table>'+                                            '<input type="button" name="insert" value="Insert" />&nbsp;'+                                            '<input type="button" name="cancel" value="cancel" />'+                                        '</form>'+                                      '</div>');                    var sizes = json.sizes.size;                    $sizeBox.prepend(thumbnail);                     // create float box                    $('body').append($sizeBox);                     // append selects;                    var len = sizes.length;                    for ( var i=0; i < len; i++ ) {                        var size = sizes[i];                        $('table', $sizeBox).append('<tr>'+                                                        '<th>'+size.label+' ( '+size.width+' × '+size.height+ ')</th>'+                                                        '<td><input type="radio" name="normal" value="'+size.source+'" /></td>'+                                                        '<td><input type="radio" name="large" value="'+size.source+'" /></td>'+                                                    '</tr>');                    }                     // centering                    $sizeBox.position({                        'of'    : window,                        'my'    : 'center center'                    }).hide().fadeIn('200');                     $('[name="insert"]', $sizeBox).click(function()                    {                        $normal.val($('input[name="normal"]:checked', $sizeBox).val());                        $large.val($('input[name="large"]:checked', $sizeBox).val());                        $('#js-flickr-size_box').remove();                    });                    $('[name="cancel"]', $sizeBox).click(function()                    {                        $('#js-flickr-size_box').remove();                    });                 } else {                    // error                }            }        });                 return false;    });});</script>